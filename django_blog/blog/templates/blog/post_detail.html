<!-- part of blog/templates/blog/post_detail.html -->
<article>
  <h1>{{ post.title }}</h1>
  <p class="text-muted">By {{ post.author }} — {{ post.created_at|date:"M j, Y H:i" }}</p>
  <div>{{ post.content|linebreaks }}</div>

  <hr>
  <!-- Comments section -->
  <section id="comments" class="mt-4">
    <h4>Comments ({{ post.comments.count }})</h4>

    {% if post.comments.exists %}
      <ul class="list-unstyled">
        {% for comment in post.comments.all %}
          <li class="media mb-3 p-3 border rounded">
            <div class="media-body">
              <h6 class="mt-0 mb-1">{{ comment.author }} <small class="text-muted">— {{ comment.created_at|timesince }} ago</small></h6>
              <p>{{ comment.content|linebreaks }}</p>
              <div>
                {% if user == comment.author %}
                  <a class="btn btn-sm btn-secondary" href="{% url 'blog:comment-update' comment.pk %}">Edit</a>
                  <a class="btn btn-sm btn-danger" href="{% url 'blog:comment-delete' comment.pk %}">Delete</a>
                {% endif %}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No comments yet. Be the first to comment.</p>
    {% endif %}

    <hr>
    <!-- Add comment form or link to it -->
    {% if user.is_authenticated %}
      <div class="mb-3">
        <form method="post" action="{% url 'blog:comment-create' post_pk=post.pk %}">
          {% csrf_token %}
          {{ comment_form.non_field_errors }}
          <div class="mb-2">
            {{ comment_form.content }}
            {% for err in comment_form.content.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
          </div>
          <button type="submit" class="btn btn-primary btn-sm">Post comment</button>
        </form>
      </div>
    {% else %}
      <p><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to post a comment.</p>
    {% endif %}
  </section>

  <a class="btn btn-link" href="{% url 'blog:post-list' %}">Back to posts</a>
</article>
<div class="post-tags">
  {% if post.tags.all %}
    <span>Tags:</span>
    {% for tag in post.tags.all %}
      <a href="{% url 'posts_by_tag' tag.name %}" class="tag-link">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
  {% endif %}
</div>
